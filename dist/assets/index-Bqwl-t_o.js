(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const h="http://localhost:5001/api/notes";class u{static async getNotes(){return(await fetch(h)).json()}static async addNote(t){return(await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}static async updateNote(t,n){return(await fetch(`${h}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()}static async deleteNote(t){await fetch(`${h}/${t}`,{method:"DELETE"})}}class M{static getTheme(){return localStorage.getItem("theme_preference")||"dark"}static saveTheme(t){localStorage.setItem("theme_preference",t)}}let c=[],a=null,w="",T="all",l=null;const g=document.getElementById("pinned-notes"),C=document.getElementById("regular-notes"),y=document.querySelector(".editor-title-input"),v=document.querySelector(".editor-body"),E=document.getElementById("sync-status"),x=document.getElementById("sync-icon"),$=document.getElementById("all-count"),D=document.getElementById("pinned-count"),_=document.getElementById("search-input"),P=document.getElementById("add-note-btn"),O=document.getElementById("delete-btn"),f=document.getElementById("pin-btn"),I=document.querySelectorAll(".nav-item"),N=document.querySelectorAll(".tag-chip");document.addEventListener("DOMContentLoaded",async()=>{const o=M.getTheme();document.body.classList.toggle("light-theme",o==="light"),b(o),await k(),c.length>0&&L(c[0]._id),F()});async function k(){m();try{c=await u.getNotes(),d(),p("Database")}catch(o){console.error("Failed to fetch notes",o),E.textContent="Error fetching notes"}}function F(){const o=document.getElementById("theme-toggle");o&&o.addEventListener("click",()=>{const e=document.body.classList.toggle("light-theme")?"light":"dark";M.saveTheme(e),b(e)}),_.addEventListener("input",n=>{w=n.target.value.toLowerCase(),d()}),P.addEventListener("click",async()=>{const n={title:"Untitled Note",content:"<p>Start writing...</p>",tags:[],pinned:!1,lastModified:Date.now()};m();try{const e=await u.addNote(n);c.unshift(e),d(),L(e._id),p("Database")}catch(e){console.error("Failed to add note",e)}}),O.addEventListener("click",async()=>{if(a){m();try{await u.deleteNote(a),c=c.filter(n=>n._id!==a),d(),c.length>0?L(c[0]._id):q(),p("Database")}catch(n){console.error("Failed to delete note",n)}}}),f.addEventListener("click",async()=>{if(a){const n=c.find(e=>e._id===a);if(n){const e=!n.pinned;m();try{const s=await u.updateNote(a,{pinned:e,lastModified:Date.now()}),i=c.findIndex(r=>r._id===a);i!==-1&&(c[i]=s),d(),B(s.pinned),p("Database")}catch(s){console.error("Failed to update pin status",s)}}}});let t;[y,v].forEach(n=>{n.addEventListener("input",()=>{a&&(clearTimeout(t),m(),t=window.setTimeout(async()=>{if(c.find(s=>s._id===a))try{const s=await u.updateNote(a,{title:y.value,content:v.innerHTML,lastModified:Date.now()}),i=c.findIndex(r=>r._id===a);i!==-1&&(c[i]=s),d(),p("Database")}catch(s){console.error("Failed to auto-save",s)}},1e3))})}),I.forEach(n=>{n.addEventListener("click",()=>{I.forEach(e=>e.classList.remove("active")),n.classList.add("active"),T=n.dataset.filter||"all",l=null,N.forEach(e=>e.classList.remove("active")),d()})}),N.forEach(n=>{n.addEventListener("click",()=>{const e=n.textContent?.trim()||"";l===e?(l=null,n.classList.remove("active")):(l=e,N.forEach(s=>s.classList.remove("active")),n.classList.add("active")),d()})})}function d(){const o=c.filter(e=>{const s=e.title.toLowerCase().includes(w)||e.content.toLowerCase().includes(w),i=T==="all"||T==="pinned"&&e.pinned,r=!l||e.tags.includes(l);return s&&i&&r});o.sort((e,s)=>e.pinned!==s.pinned?e.pinned?-1:1:s.lastModified-e.lastModified);const t=o.filter(e=>e.pinned),n=o.filter(e=>!e.pinned);$.textContent=c.length.toString(),D.textContent=c.filter(e=>e.pinned).length.toString(),g.innerHTML='<h3 class="group-title">Pinned</h3>',C.innerHTML='<h3 class="group-title">Recent</h3>',t.length===0?g.style.display="none":g.style.display="block",t.forEach(e=>g.appendChild(S(e))),n.forEach(e=>C.appendChild(S(e)))}function S(o){const t=document.createElement("div"),n=o._id;return t.className=`note-card ${n===a?"active":""} ${o.pinned?"pinned":""}`,t.innerHTML=`
    <div class="note-card-header">
      <h4 class="note-title">${o.title||"Untitled"}</h4>
      <i class="fas fa-thumbtack pin-icon ${o.pinned?"":"hidden"}"></i>
    </div>
    <p class="note-preview">${H(o.content)}</p>
    <div class="note-meta">
      <div class="note-tags">
        ${o.tags.map(e=>`<span class="tag-dot ${e.toLowerCase()}"></span>`).join("")}
      </div>
      <span class="note-time">${j(o.lastModified)}</span>
    </div>
  `,t.addEventListener("click",()=>L(n)),t}function L(o){a=o;const t=c.find(n=>n._id===o);t&&(y.value=t.title,v.innerHTML=t.content,B(t.pinned),d())}function q(){a=null,y.value="",v.innerHTML="",E.textContent="No note selected"}function b(o){const t=document.querySelector(".theme-toggle i"),n=document.querySelector(".theme-toggle span");t&&n&&(o==="light"?(t.className="fas fa-sun",n.textContent="Light Mode"):(t.className="fas fa-moon",n.textContent="Dark Mode"))}function B(o){o?(f.classList.add("active"),f.style.color="var(--accent)"):(f.classList.remove("active"),f.style.color="var(--text-muted)")}function m(){E.textContent="Syncing...",x.className="fas fa-sync fa-spin sync-icon"}function p(o="Cloud"){E.textContent=`Synced to ${o}`,x.className="fas fa-cloud-check sync-icon"}function H(o){const t=document.createElement("div");return t.innerHTML=o,t.textContent||t.innerText||""}function j(o){const t=Date.now()-o;return t<6e4?"Just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:new Date(o).toLocaleDateString()}
