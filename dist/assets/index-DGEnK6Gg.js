(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const l="http://localhost:5001/api";class u{static getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("notes_token")}`}}static async register(t,i,e){const n=await fetch(`${l}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:i,role:e})});if(!n.ok){const s=await n.json();throw new Error(s.message||"Registration failed")}return n.json()}static async login(t,i){const e=await fetch(`${l}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:i})});if(!e.ok){const n=await e.json();throw new Error(n.message||"Login failed")}return e.json()}static logout(){localStorage.removeItem("notes_token"),localStorage.removeItem("user_role"),localStorage.removeItem("username"),window.location.href="login.html"}static async getNotes(){const t=await fetch(`${l}/notes`,{headers:this.getHeaders()});if(t.status===401||t.status===403)throw this.logout(),new Error("Unauthorized");return t.json()}static async addNote(t){return(await fetch(`${l}/notes`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(t)})).json()}static async updateNote(t,i){return(await fetch(`${l}/notes/${t}`,{method:"PUT",headers:this.getHeaders(),body:JSON.stringify(i)})).json()}static async deleteNote(t){await fetch(`${l}/notes/${t}`,{method:"DELETE",headers:this.getHeaders()})}}class b{static getTheme(){return localStorage.getItem("theme_preference")||"dark"}static saveTheme(t){localStorage.setItem("theme_preference",t)}}let a=[],r=null,N="",T="all",f=null;const p=document.getElementById("pinned-notes"),I=document.getElementById("regular-notes"),y=document.querySelector(".editor-title-input"),v=document.querySelector(".editor-body"),w=document.getElementById("sync-status"),M=document.getElementById("sync-icon"),k=document.getElementById("all-count"),_=document.getElementById("pinned-count"),D=document.getElementById("search-input"),O=document.getElementById("add-note-btn"),H=document.getElementById("delete-btn"),m=document.getElementById("pin-btn"),C=document.querySelectorAll(".nav-item"),S=document.querySelectorAll(".tag-chip");document.addEventListener("DOMContentLoaded",async()=>{if(!localStorage.getItem("notes_token")){window.location.href="login.html";return}const t=b.getTheme();document.body.classList.toggle("light-theme",t==="light"),$(t);const i=localStorage.getItem("username"),e=localStorage.getItem("user_role"),n=document.querySelector(".user-info h4"),s=document.querySelector(".user-info p");n&&(n.textContent=i||"User"),s&&(s.textContent=e==="admin"?"Administrator":"Basic User"),await P(),a.length>0&&L(a[0]._id),j()});async function P(){g();try{a=await u.getNotes(),d(),h("Database")}catch(o){console.error("Failed to fetch notes",o),w.textContent="Error fetching notes"}}function j(){const o=document.getElementById("theme-toggle");o&&o.addEventListener("click",()=>{const n=document.body.classList.toggle("light-theme")?"light":"dark";b.saveTheme(n),$(n)});const t=document.getElementById("logout-btn");t&&t.addEventListener("click",()=>{u.logout()}),D.addEventListener("input",e=>{N=e.target.value.toLowerCase(),d()}),O.addEventListener("click",async()=>{const e={title:"Untitled Note",content:"<p>Start writing...</p>",tags:[],pinned:!1,lastModified:Date.now()};g();try{const n=await u.addNote(e);a.unshift(n),d(),L(n._id),h("Database")}catch(n){console.error("Failed to add note",n)}}),H.addEventListener("click",async()=>{if(r){g();try{await u.deleteNote(r),a=a.filter(e=>e._id!==r),d(),a.length>0?L(a[0]._id):q(),h("Database")}catch(e){console.error("Failed to delete note",e)}}}),m.addEventListener("click",async()=>{if(r){const e=a.find(n=>n._id===r);if(e){const n=!e.pinned;g();try{const s=await u.updateNote(r,{pinned:n,lastModified:Date.now()}),c=a.findIndex(E=>E._id===r);c!==-1&&(a[c]=s),d(),B(s.pinned),h("Database")}catch(s){console.error("Failed to update pin status",s)}}}});let i;[y,v].forEach(e=>{e.addEventListener("input",()=>{r&&(clearTimeout(i),g(),i=window.setTimeout(async()=>{if(a.find(s=>s._id===r))try{const s=await u.updateNote(r,{title:y.value,content:v.innerHTML,lastModified:Date.now()}),c=a.findIndex(E=>E._id===r);c!==-1&&(a[c]=s),d(),h("Database")}catch(s){console.error("Failed to auto-save",s)}},1e3))})}),C.forEach(e=>{e.addEventListener("click",()=>{C.forEach(n=>n.classList.remove("active")),e.classList.add("active"),T=e.dataset.filter||"all",f=null,S.forEach(n=>n.classList.remove("active")),d()})}),S.forEach(e=>{e.addEventListener("click",()=>{const n=e.textContent?.trim()||"";f===n?(f=null,e.classList.remove("active")):(f=n,S.forEach(s=>s.classList.remove("active")),e.classList.add("active")),d()})})}function d(){const o=a.filter(e=>{const n=e.title.toLowerCase().includes(N)||e.content.toLowerCase().includes(N),s=T==="all"||T==="pinned"&&e.pinned,c=!f||e.tags.includes(f);return n&&s&&c});o.sort((e,n)=>e.pinned!==n.pinned?e.pinned?-1:1:n.lastModified-e.lastModified);const t=o.filter(e=>e.pinned),i=o.filter(e=>!e.pinned);k.textContent=a.length.toString(),_.textContent=a.filter(e=>e.pinned).length.toString(),p.innerHTML='<h3 class="group-title">Pinned</h3>',I.innerHTML='<h3 class="group-title">Recent</h3>',t.length===0?p.style.display="none":p.style.display="block",t.forEach(e=>p.appendChild(x(e))),i.forEach(e=>I.appendChild(x(e)))}function x(o){const t=document.createElement("div"),i=o._id;return t.className=`note-card ${i===r?"active":""} ${o.pinned?"pinned":""}`,t.innerHTML=`
    <div class="note-card-header">
      <h4 class="note-title">${o.title||"Untitled"}</h4>
      <i class="fas fa-thumbtack pin-icon ${o.pinned?"":"hidden"}"></i>
    </div>
    <p class="note-preview">${U(o.content)}</p>
    <div class="note-meta">
      <div class="note-tags">
        ${o.tags.map(e=>`<span class="tag-dot ${e.toLowerCase()}"></span>`).join("")}
      </div>
      <span class="note-time">${F(o.lastModified)}</span>
    </div>
  `,t.addEventListener("click",()=>L(i)),t}function L(o){r=o;const t=a.find(i=>i._id===o);t&&(y.value=t.title,v.innerHTML=t.content,B(t.pinned),d())}function q(){r=null,y.value="",v.innerHTML="",w.textContent="No note selected"}function $(o){const t=document.querySelector(".theme-toggle i"),i=document.querySelector(".theme-toggle span");t&&i&&(o==="light"?(t.className="fas fa-sun",i.textContent="Light Mode"):(t.className="fas fa-moon",i.textContent="Dark Mode"))}function B(o){o?(m.classList.add("active"),m.style.color="var(--accent)"):(m.classList.remove("active"),m.style.color="var(--text-muted)")}function g(){w.textContent="Syncing...",M.className="fas fa-sync fa-spin sync-icon"}function h(o="Cloud"){w.textContent=`Synced to ${o}`,M.className="fas fa-cloud-check sync-icon"}function U(o){const t=document.createElement("div");return t.innerHTML=o,t.textContent||t.innerText||""}function F(o){const t=Date.now()-o;return t<6e4?"Just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:new Date(o).toLocaleDateString()}
